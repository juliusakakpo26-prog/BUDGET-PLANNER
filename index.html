<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flux ‚Äî Suivi Budg√©taire</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- ===== SIDEBAR ===== -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-mark">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
            <path d="M10 2L17.32 6.5V15.5L10 20L2.68 15.5V6.5L10 2Z" fill="white"/>
          </svg>
        </div>
        <span class="logo-text">Flux</span>
      </div>
      <button class="sidebar-toggle" id="sidebarToggle">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
          <path d="M2 4h14M2 9h14M2 14h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <!-- User profile block like in the reference image -->
    <div class="sidebar-user">
      <div class="sidebar-avatar">AC</div>
      <div class="sidebar-user-info">
        <div class="sidebar-user-name">Alexa Cubert</div>
        <div class="sidebar-user-role">Compte personnel</div>
      </div>
    </div>

    <ul class="nav-links">
      <li>
        <a href="#" class="nav-link active" data-view="dashboard">
          <svg class="nav-icon" width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="2" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="10" y="2" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="2" y="10" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="10" y="10" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/></svg>
          <span>Tableau de bord</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-link" data-view="add">
          <svg class="nav-icon" width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/><path d="M9 6v6M6 9h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          <span>Nouvelle op√©ration</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-link" data-view="history">
          <svg class="nav-icon" width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 5v4l2.5 2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M3.5 9A5.5 5.5 0 1 0 9 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M3.5 5v4H7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Historique</span>
          <span class="nav-badge" id="txnBadge">0</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-link" data-view="analytics">
          <svg class="nav-icon" width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M2 13l4-4 3 3 4-5 3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 16h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          <span>Analytiques</span>
        </a>
      </li>
    </ul>

    <div class="sidebar-footer">
      <div class="month-selector">
        <button class="month-btn" id="prevMonth">‚Äπ</button>
        <span class="month-label" id="monthLabel">F√©vrier 2026</span>
        <button class="month-btn" id="nextMonth">‚Ä∫</button>
      </div>
    </div>
  </nav>

  <div class="overlay" id="overlay"></div>

  <!-- ===== MAIN ===== -->
  <main class="main-content">
    <header class="topbar">
      <button class="mobile-menu-btn" id="mobileMenuBtn">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
      <div class="topbar-title" id="topbarTitle">Tableau de bord</div>
      <div class="topbar-actions">
        <button class="btn-ghost" id="accountBtn">Compte</button>
        <button class="btn-ghost" id="cloudSyncBtn">Sync Cloud</button>
        <button class="btn-ghost" id="googleConnectBtn">Connexion Google</button>
        <button class="btn-ghost" id="googleSyncBtn">Sync</button>
        <button class="btn-ghost" id="googleDisconnectBtn">Disconnect</button>
        <button class="btn-ghost" id="exportBtn">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M2 11v2a1 1 0 001 1h10a1 1 0 001-1v-2M8 2v8M5 7l3 3 3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Export CSV
        </button>
      </div>
    </header>
    <div class="cloud-status" id="cloudStatus">Cloud: non configure</div>
    <div class="google-status" id="googleStatus">Google: non connecte</div>
    <div class="auth-modal-backdrop hidden" id="authModalBackdrop">
      <div class="auth-modal" role="dialog" aria-modal="true" aria-labelledby="authModalTitle">
        <button class="auth-modal-close" id="authModalClose" aria-label="Fermer">x</button>
        <h3 id="authModalTitle">Compte Cloud</h3>
        <p>Connectez-vous pour synchroniser vos donnees entre appareils.</p>

        <label for="authEmail" class="auth-label">Email</label>
        <input id="authEmail" class="auth-input" type="email" placeholder="email@exemple.com" autocomplete="email">

        <label for="authPassword" class="auth-label">Mot de passe</label>
        <input id="authPassword" class="auth-input" type="password" placeholder="Minimum 6 caracteres" autocomplete="current-password">

        <div class="auth-actions">
          <button class="btn-ghost" id="authSignupBtn">Creer un compte</button>
          <button class="btn-primary" id="authLoginBtn">Connexion</button>
        </div>

        <div class="auth-divider"></div>
        <div class="auth-user-row">
          <span id="authUserLabel">Non connecte</span>
          <button class="btn-ghost" id="authLogoutBtn">Se deconnecter</button>
        </div>
      </div>
    </div>
    <div class="google-modal-backdrop hidden" id="googleModalBackdrop">
      <div class="google-modal" role="dialog" aria-modal="true" aria-labelledby="googleModalTitle">
        <button class="google-modal-close" id="googleModalClose" aria-label="Fermer">x</button>
        <h3 id="googleModalTitle">Connexion Google Sheets</h3>
        <p>Collez le lien de votre fichier Google Sheet pour connecter Flux.</p>
        <label for="googleSheetUrlModal" class="google-modal-label">Lien Google Sheet</label>
        <input
          id="googleSheetUrlModal"
          class="google-modal-input"
          type="text"
          placeholder="https://docs.google.com/spreadsheets/d/..."
          aria-label="Lien Google Sheet"
        >
        <div class="google-modal-actions">
          <button class="btn-ghost" id="googleModalCancel">Annuler</button>
          <button class="btn-primary" id="googleModalConfirm">Connecter</button>
        </div>
      </div>
    </div>

    <!-- ======= DASHBOARD ======= -->
    <section class="view active" id="view-dashboard">
      <div class="view-header">
        <p style="font-size:0.875rem;color:var(--text-secondary);margin-bottom:2px">Welcome back!</p>
        <h1>Hello, Alex! üëã</h1>
      </div>

      <!-- KPIs -->
      <div class="kpi-grid">
        <div class="kpi-card kpi-balance">
          <div>
            <div class="kpi-label">Solde Total</div>
            <div class="kpi-amount" id="kpiBalance">+ 0 FCFA</div>
            <div class="kpi-trend" id="kpiBalanceTrend">‚Äî</div>
          </div>
          <div class="kpi-balance-action">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8h10M9 4l4 4-4 4" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <div class="kpi-bar" style="grid-column:span 2">
            <div class="kpi-bar-fill" id="kpiBalanceFill" style="width:0%"></div>
          </div>
        </div>

        <div class="kpi-card kpi-income">
          <div class="kpi-icon">
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M10 16V4M4 10l6-6 6 6" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <div class="kpi-label">Recettes</div>
          <div class="kpi-amount kpi-amount-green" id="kpiIncome">0 FCFA</div>
          <div class="kpi-count" id="kpiIncomeCount">0 op√©ration(s)</div>
        </div>

        <div class="kpi-card kpi-expense">
          <div class="kpi-icon">
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M10 4v12M4 10l6 6 6-6" stroke="var(--red)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <div class="kpi-label">D√©penses</div>
          <div class="kpi-amount kpi-amount-red" id="kpiExpense">0 FCFA</div>
          <div class="kpi-count" id="kpiExpenseCount">0 op√©ration(s)</div>
        </div>
      </div>

      <!-- Charts -->
      <div class="charts-row">
        <div class="chart-card chart-donut-card">
          <div class="chart-header">
            <span class="chart-title">R√©partition</span>
            <span class="chart-badge">Ce mois</span>
          </div>
          <div class="donut-container">
            <canvas id="donutChart" width="160" height="160"></canvas>
            <div class="donut-center">
              <span class="donut-pct" id="donutPct">0%</span>
              <span class="donut-label">√©pargn√©</span>
            </div>
          </div>
          <div class="donut-legend" id="donutLegend"></div>
        </div>

        <div class="chart-card chart-bar-card">
          <div class="chart-header">
            <span class="chart-title">√âvolution mensuelle</span>
            <span class="chart-badge">6 mois</span>
          </div>
          <div class="bar-chart-container">
            <canvas id="barChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Recent Transactions -->
      <div class="section-card">
        <div class="section-header">
          <h3>Recent Transactions</h3>
          <button class="link-btn" data-view="history">Voir tout ‚Üí</button>
        </div>
        <div class="txn-list" id="recentTxns">
          <div class="empty-state">
            <div class="empty-icon">üìä</div>
            <p>Aucune op√©ration ce mois</p>
            <button class="btn-primary" data-view="add" style="margin-top:8px;font-size:0.8rem;padding:8px 16px">Ajouter</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ======= ADD OPERATION ======= -->
    <section class="view" id="view-add">
      <div class="view-header">
        <h1>Nouvelle op√©ration</h1>
        <p class="view-subtitle">Enregistrez une recette ou une d√©pense</p>
      </div>

      <div class="form-container">
        <div class="type-switcher">
          <button class="type-btn active" data-type="D√©pense" id="btnDepense">
            <svg width="15" height="15" viewBox="0 0 16 16" fill="none"><path d="M8 2v10M3 8l5 5 5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            D√©pense
          </button>
          <button class="type-btn" data-type="Recette" id="btnRecette">
            <svg width="15" height="15" viewBox="0 0 16 16" fill="none"><path d="M8 12V2M3 6l5-5 5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Recette
          </button>
        </div>

        <div class="form-card">
          <div class="form-group">
            <label class="form-label" for="fieldDate">Date <span class="required">*</span></label>
            <input type="date" id="fieldDate" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="fieldIntitule">Intitul√© <span class="required">*</span></label>
            <input type="text" id="fieldIntitule" class="form-input" placeholder="Ex: Loyer, Salaire, Courses..." maxlength="100" required>
            <div class="char-counter"><span id="charCount">0</span>/100</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="fieldMontant">Montant <span class="required">*</span></label>
            <div class="input-with-suffix">
              <input type="number" id="fieldMontant" class="form-input" placeholder="0" min="0" step="1" required>
              <span class="input-suffix">FCFA</span>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="fieldCategorie">Cat√©gorie <span class="required">*</span></label>
            <div class="select-wrapper">
              <select id="fieldCategorie" class="form-input form-select" required>
                <option value="">‚Äî S√©lectionner ‚Äî</option>
              </select>
              <svg class="select-icon" width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="fieldNote">Note (optionnel)</label>
            <textarea id="fieldNote" class="form-input form-textarea" placeholder="Commentaire..." rows="2" maxlength="200"></textarea>
          </div>
          <div class="form-actions">
            <button class="btn-ghost" id="btnReset">R√©initialiser</button>
            <button class="btn-primary" id="btnSubmit">
              <span class="btn-text">Enregistrer</span>
              <span class="btn-spinner hidden">
                <svg class="spin" width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="2" stroke-dasharray="20 18"/></svg>
              </span>
            </button>
          </div>
        </div>

        <div class="toast hidden" id="toast">
          <div class="toast-icon" id="toastIcon"></div>
          <div class="toast-msg" id="toastMsg"></div>
        </div>
      </div>
    </section>

    <!-- ======= HISTORY ======= -->
    <section class="view" id="view-history">
      <div class="view-header">
        <h1>Historique</h1>
        <p class="view-subtitle">Toutes vos op√©rations financi√®res</p>
      </div>

      <div class="filters-bar">
        <div class="filter-group">
          <input type="text" id="filterSearch" class="filter-input" placeholder="üîç Rechercher...">
        </div>
        <div class="filter-group">
          <select id="filterType" class="filter-select">
            <option value="">Tous les types</option>
            <option value="Recette">Recettes</option>
            <option value="D√©pense">D√©penses</option>
          </select>
        </div>
        <div class="filter-group">
          <select id="filterCat" class="filter-select">
            <option value="">Toutes cat√©gories</option>
          </select>
        </div>
        <div class="filter-group">
          <select id="filterMonth" class="filter-select">
            <option value="">Tous les mois</option>
          </select>
        </div>
      </div>

      <div class="filter-summary" id="filterSummary">
        <span id="filterResultCount">0 r√©sultat(s)</span>
        <span class="filter-summary-amounts">
          <span class="amount-green" id="filterIncomeSum">Recettes: 0</span>
          <span class="amount-red" id="filterExpenseSum">D√©penses: 0</span>
          <span class="amount-accent" id="filterBalance">Solde: 0</span>
        </span>
      </div>

      <div class="table-wrapper">
        <table class="txn-table" id="txnTable">
          <thead>
            <tr>
              <th class="sortable" data-sort="date">Date <span class="sort-icon">‚Üï</span></th>
              <th class="sortable" data-sort="intitule">Intitul√© <span class="sort-icon">‚Üï</span></th>
              <th>Cat√©gorie</th>
              <th class="sortable" data-sort="type">Type <span class="sort-icon">‚Üï</span></th>
              <th class="sortable text-right" data-sort="montant">Montant <span class="sort-icon">‚Üï</span></th>
            </tr>
          </thead>
          <tbody id="txnTableBody">
            <tr>
              <td colspan="5" class="empty-row">
                <div class="empty-state">
                  <div class="empty-icon">üìã</div>
                  <p>Aucune op√©ration enregistr√©e</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ======= ANALYTICS ======= -->
    <section class="view" id="view-analytics">
      <div class="view-header">
        <h1>Analytiques</h1>
        <p class="view-subtitle">Insights sur vos habitudes financi√®res</p>
      </div>

      <div class="analytics-grid">
        <div class="chart-card analytics-full">
          <div class="chart-header">
            <span class="chart-title">Flux financiers ‚Äî 12 mois</span>
            <span class="chart-badge">Income / Spend</span>
          </div>
          <canvas id="lineChart" height="110"></canvas>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <span class="chart-title">Top d√©penses</span>
          </div>
          <div id="topExpenses" class="top-list"></div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <span class="chart-title">Top recettes</span>
          </div>
          <div id="topIncomes" class="top-list"></div>
        </div>

        <div class="chart-card analytics-full">
          <div class="chart-header">
            <span class="chart-title">Taux d'√©pargne</span>
          </div>
          <div class="savings-rate-display">
            <div class="savings-ring-container">
              <canvas id="savingsChart" width="160" height="160"></canvas>
              <div class="savings-center">
                <span id="savingsRate">0%</span>
                <small>taux d'√©pargne</small>
              </div>
            </div>
            <div class="savings-breakdown" id="savingsBreakdown"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="config.js"></script>
  <script src="app.js"></script>
</body>
</html>
