<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flux - Budget Planner</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Sora:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <a class="skip-link" href="#mainContent">Aller au contenu</a>
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <button type="button" class="logo logo-btn" data-view="account" aria-label="Ouvrir la page utilisateur">
        <span class="logo-mark">F</span>
        <span class="logo-text">Flux</span>
      </button>
      <button type="button" class="icon-btn" id="sidebarToggle" aria-label="Fermer le menu">✕</button>
    </div>

    <button type="button" class="profile-card clickable" data-view="account" aria-label="Ouvrir la page utilisateur">
      <span class="avatar">BU</span>
      <span>
        <strong class="profile-name">Budget User</strong>
        <small class="profile-role">Infos de connexion</small>
      </span>
    </button>

    <ul class="nav-links">
      <li>
        <a href="#" class="nav-link active" data-view="dashboard" aria-label="Tableau de bord">
          <span class="nav-link-content">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" focusable="false">
                <rect x="3" y="3" width="8" height="8" rx="2"></rect>
                <rect x="13" y="3" width="8" height="5" rx="2"></rect>
                <rect x="13" y="10" width="8" height="11" rx="2"></rect>
                <rect x="3" y="13" width="8" height="8" rx="2"></rect>
              </svg>
            </span>
            <span class="nav-label">Tableau de bord</span>
          </span>
          <span class="nav-link-trailing"></span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-link" data-view="add" aria-label="Nouvelle operation">
          <span class="nav-link-content">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" focusable="false">
                <circle cx="12" cy="12" r="9"></circle>
                <path d="M12 8v8M8 12h8"></path>
              </svg>
            </span>
            <span class="nav-label">Nouvelle operation</span>
          </span>
          <span class="nav-link-trailing"></span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-link" data-view="history" aria-label="Historique">
          <span class="nav-link-content">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" focusable="false">
                <path d="M3 12a9 9 0 1 0 3-6.7"></path>
                <path d="M3 4v5h5"></path>
                <path d="M12 7v5l3 2"></path>
              </svg>
            </span>
            <span class="nav-label">Historique</span>
          </span>
          <span class="nav-link-trailing"><span class="nav-badge" id="txnBadge">0</span></span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-link" data-view="analytics" aria-label="Analytiques">
          <span class="nav-link-content">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" focusable="false">
                <path d="M4 19h16"></path>
                <path d="M7 15l3-3 3 2 4-5"></path>
                <circle cx="7" cy="15" r="1"></circle>
                <circle cx="10" cy="12" r="1"></circle>
                <circle cx="13" cy="14" r="1"></circle>
                <circle cx="17" cy="9" r="1"></circle>
              </svg>
            </span>
            <span class="nav-label">Analytiques</span>
          </span>
          <span class="nav-link-trailing"></span>
        </a>
      </li>
    </ul>

    <div class="sidebar-footer">
      <button type="button" class="month-btn" id="prevMonth" aria-label="Mois precedent">‹</button>
      <span id="monthLabel">-</span>
      <button type="button" class="month-btn" id="nextMonth" aria-label="Mois suivant">›</button>
    </div>
  </nav>

  <div class="overlay" id="overlay"></div>

  <main class="main-content" id="mainContent">
    <header class="topbar">
      <button type="button" class="icon-btn mobile-only" id="mobileMenuBtn" aria-label="Ouvrir le menu">☰</button>
      <h2 id="topbarTitle">Tableau de bord</h2>
      <div class="topbar-actions">
        <button type="button" class="btn ghost" id="topConnectBtn" data-view="account">Connexion</button>
        <button type="button" class="btn ghost" id="exportBtn">Export</button>
      </div>
    </header>

    <section class="view active" id="view-dashboard">
      <div class="view-head">
        <h1>Tableau de bord</h1>
        <p>Vue rapide de vos recettes, depenses et solde du mois.</p>
      </div>

      <div class="kpi-grid">
        <article class="card kpi balance">
          <p>Solde total</p>
          <h3 id="kpiBalance">+ 0 FCFA</h3>
          <small id="kpiBalanceTrend">-</small>
          <div class="meter"><div id="kpiBalanceFill"></div></div>
        </article>
        <article class="card kpi">
          <p>Recettes</p>
          <h3 id="kpiIncome">0 FCFA</h3>
          <small id="kpiIncomeCount">0 operation(s)</small>
        </article>
        <article class="card kpi">
          <p>Depenses</p>
          <h3 id="kpiExpense">0 FCFA</h3>
          <small id="kpiExpenseCount">0 operation(s)</small>
        </article>
      </div>

      <article class="card form-card dashboard-form">
        <div class="card-head"><h3>Nouvelle operation</h3><span class="pill">Rapide</span></div>
        <div class="type-switcher">
          <button type="button" class="btn type active" id="btnDepense">Depense</button>
          <button type="button" class="btn type" id="btnRecette">Recette</button>
        </div>

        <div class="form-grid">
          <label>Date
            <input id="fieldDate" class="field" type="date" required>
          </label>
          <label>Intitule
            <input id="fieldIntitule" class="field" type="text" maxlength="100" placeholder="Ex: Loyer" required>
            <small><span id="charCount">0</span>/100</small>
          </label>
          <label>Montant
            <input id="fieldMontant" class="field" type="number" min="1" step="1" placeholder="0" required>
          </label>
          <label>Categorie
            <select id="fieldCategorie" class="field" required></select>
          </label>
          <label class="full">Note
            <textarea id="fieldNote" class="field" rows="3" maxlength="200" placeholder="Commentaire (optionnel)"></textarea>
          </label>
        </div>

        <div class="actions-row">
          <button type="button" class="btn ghost" id="btnReset">Reinitialiser</button>
          <button type="button" class="btn primary" id="btnSubmit">
            <span class="btn-text">Enregistrer</span>
            <span class="btn-spinner hidden" aria-hidden="true">...</span>
          </button>
        </div>
        <div class="toast hidden" id="toast" role="status" aria-live="polite"><span id="toastMsg"></span></div>
      </article>

      <article class="card">
        <div class="card-head">
          <h3>Recent transactions</h3>
          <button type="button" class="link-btn" data-view="history">Voir tout</button>
        </div>
        <div id="recentTxns" class="tx-list"></div>
      </article>
    </section>

    <section class="view" id="view-add">
      <div class="view-head">
        <h1>Nouvelle operation</h1>
        <p>Le formulaire est maintenant directement sur le tableau de bord.</p>
      </div>

      <article class="card form-card">
        <p class="status-text">Pour ajouter une transaction rapidement, allez sur <strong>Tableau de bord</strong>.</p>
        <div class="actions-row left">
          <button type="button" class="btn primary" data-view="dashboard">Aller au dashboard</button>
        </div>
      </article>
    </section>

    <section class="view" id="view-history">
      <div class="view-head">
        <h1>Historique</h1>
        <p>Toutes les operations enregistrees.</p>
      </div>

      <article class="card">
        <div class="filters">
          <input id="filterSearch" class="field" type="text" placeholder="Rechercher...">
          <select id="filterType" class="field">
            <option value="">Tous les types</option>
            <option value="Recette">Recette</option>
            <option value="Depense">Depense</option>
          </select>
          <select id="filterCat" class="field"><option value="">Toutes categories</option></select>
          <select id="filterMonth" class="field"><option value="">Tous les mois</option></select>
        </div>

        <div class="summary" id="filterSummary">
          <span id="filterResultCount">0 resultat</span>
          <span id="filterIncomeSum">Recettes: 0 FCFA</span>
          <span id="filterExpenseSum">Depenses: 0 FCFA</span>
          <span id="filterBalance">Solde: 0 FCFA</span>
        </div>

        <div class="table-wrap">
          <table class="tx-table">
            <thead>
              <tr>
                <th class="sortable" data-sort="date">Date</th>
                <th class="sortable" data-sort="intitule">Intitule</th>
                <th>Categorie</th>
                <th class="sortable" data-sort="type">Type</th>
                <th class="sortable right" data-sort="montant">Montant</th>
              </tr>
            </thead>
            <tbody id="txnTableBody"></tbody>
          </table>
        </div>
      </article>
    </section>

    <section class="view" id="view-analytics">
      <div class="view-head">
        <h1>Analytiques</h1>
        <p>Insights sur 12 mois et tops categories.</p>
      </div>

      <div class="charts-grid analytics-moved-charts">
        <article class="card">
          <div class="card-head"><h3>Repartition</h3><span class="pill">Mois</span></div>
          <div class="donut-wrap">
            <canvas id="donutChart" width="180" height="180"></canvas>
            <div class="donut-center"><span id="donutPct">0%</span><small>Epargne</small></div>
          </div>
          <div id="donutLegend" class="legend"></div>
        </article>
        <article class="card">
          <div class="card-head"><h3>Evolution (6 mois)</h3><span class="pill">Trend</span></div>
          <div class="chart-box"><canvas id="barChart"></canvas></div>
        </article>
      </div>

      <div class="analytics-grid">
        <article class="card span-2">
          <div class="card-head"><h3>Flux sur 12 mois</h3><span class="pill">Income / Spend</span></div>
          <div class="chart-box"><canvas id="lineChart" height="120"></canvas></div>
        </article>
        <article class="card">
          <div class="card-head"><h3>Top depenses</h3></div>
          <div id="topExpenses"></div>
        </article>
        <article class="card">
          <div class="card-head"><h3>Top recettes</h3></div>
          <div id="topIncomes"></div>
        </article>
        <article class="card span-2">
          <div class="card-head"><h3>Taux d epargne</h3></div>
          <div class="savings-grid">
            <div class="savings-canvas">
              <canvas id="savingsChart" width="180" height="180"></canvas>
              <div class="savings-center"><span id="savingsRate">0%</span><small>epargne</small></div>
            </div>
            <div id="savingsBreakdown"></div>
          </div>
        </article>
      </div>
    </section>

    <section class="view" id="view-account">
      <div class="view-head">
        <h1>Utilisateur</h1>
        <p>Toutes les informations de connexion et synchronisation.</p>
      </div>

      <div class="account-grid">
        <article class="card">
          <div class="card-head"><h3>Compte Cloud</h3><span class="pill">Supabase</span></div>
          <p id="cloudStatus" class="status-text" aria-live="polite">Cloud: non configure</p>
          <div class="actions-row left">
            <button type="button" class="btn ghost" id="accountBtn">Connexion / Inscription</button>
            <button type="button" class="btn ghost" id="cloudSyncBtn">Sync Cloud</button>
          </div>
        </article>

        <article class="card">
          <div class="card-head"><h3>Google Sheets</h3><span class="pill">OAuth</span></div>
          <p id="googleStatus" class="status-text" aria-live="polite">Google: non connecte</p>
          <div class="actions-row left">
            <button type="button" class="btn ghost" id="googleConnectBtn">Connexion Google</button>
            <button type="button" class="btn ghost" id="googleSyncBtn">Sync Google</button>
            <button type="button" class="btn ghost" id="googleDisconnectBtn">Disconnect</button>
          </div>
        </article>
      </div>
    </section>
  </main>

  <div class="modal-backdrop hidden" id="authModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <button type="button" class="icon-btn close" id="authModalClose" aria-label="Close">x</button>
      <h3 id="authTitle">Compte Cloud</h3>
      <p>Connectez vous pour synchroniser entre appareils.</p>
      <label>Email<input id="authEmail" class="field" type="email" placeholder="email@example.com"></label>
      <label>Mot de passe<input id="authPassword" class="field" type="password" placeholder="minimum 6 caracteres"></label>
      <div class="actions-row">
        <button type="button" class="btn ghost" id="authSignupBtn">Creer un compte</button>
        <button type="button" class="btn primary" id="authLoginBtn">Connexion</button>
      </div>
      <hr>
      <div class="modal-footer">
        <span id="authUserLabel">Non connecte</span>
        <button type="button" class="btn ghost" id="authLogoutBtn">Se deconnecter</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop hidden" id="googleModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="googleTitle">
      <button type="button" class="icon-btn close" id="googleModalClose" aria-label="Close">x</button>
      <h3 id="googleTitle">Connexion Google Sheets</h3>
      <p>Collez le lien de votre fichier Google Sheets.</p>
      <label>Lien Google Sheet
        <input id="googleSheetUrlModal" class="field" type="text" placeholder="https://docs.google.com/spreadsheets/d/...">
      </label>
      <div class="actions-row">
        <button type="button" class="btn ghost" id="googleModalCancel">Annuler</button>
        <button type="button" class="btn primary" id="googleModalConfirm">Connecter</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="config.public.js"></script>
  <script src="app.js"></script>
</body>
</html>
